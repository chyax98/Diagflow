# 语法提示词文档规范

本目录存放各图表引擎的语法提示词，供 AI Agent 生成图表代码时参考。

---

## 目录结构

```
syntax-md/
├── CLAUDE.md          # 本规范文件
├── {engine}/          # 引擎目录（小写）
│   ├── _meta.yaml     # 引擎元数据
│   └── {type}.md      # 图表类型文档
```

命名规则:
- 引擎目录: 小写，如 mermaid、plantuml、d2
- 图表文件: 小写，如 flowchart.md、sequence.md、diagram.md
- 单图表引擎使用 diagram.md

---

## _meta.yaml 格式

```yaml
language: d2                              # 引擎标识（必填）
description: 现代化图表描述语言            # 简短描述（必填）
docs_url: https://d2lang.com/             # 官方文档（可选）
version: 1.0.0                            # 版本号（可选）
```

---

## Markdown 文档结构

```
---
type: flowchart                           # 图表类型标识
description: 流程图，展示流程和决策路径    # 图表用途描述
use_cases:                                # 适用场景列表
  - 业务流程
  - 算法流程
---

## 核心语法
[基础语法规则，必会内容]

## 高级语法
[进阶功能，可选内容]

## Kroki 限制
[渲染平台特有限制]

## 常见错误
[典型错误和修正方法]

## 示例
[可运行的代码示例]
```

---

## 语法要点编写规范

### 核心语法

原则: 只写 AI 生成代码时必须知道的内容，去除冗余。

必须包含:
1. 声明语法（如何开始一个图表）
2. 基础元素（节点、连接、容器）
3. 注释语法（每个引擎不同，必须准确）
4. 特殊字符处理规则

格式要求:
```
- 规则描述: 具体语法
  * 变体1: 说明
  * 变体2: 说明
```

注释语法对照表（必须准确）:

| 引擎 | 注释语法 | 错误示例 |
|------|----------|----------|
| Mermaid | %% 注释 | // 或 # |
| PlantUML | ' 注释 或 /' 多行 '/ | // 或 # |
| D2 | # 注释 | // 或 %% |
| Graphviz | // 注释 或 /* 多行 */ | # 或 %% |

### 高级语法

原则: 仅列出 Kroki 支持的功能，明确标注限制。

内容:
- 样式定义
- 分组/嵌套
- 变量/宏（如支持）
- 导入/引用（如支持）

### Kroki 限制

必须包含:
- 节点/元素数量上限
- 嵌套层级限制
- 不支持的功能（用 X 标记）
- 可能有问题的功能（用 ! 标记）

格式:
```
## Kroki 限制
- 节点 <= 100个，嵌套 <= 3层
- X 不支持 xxx 功能
- ! xxx 可能渲染异常
```

### 常见错误

原则: 只写真实遇到的错误，用对比格式。

格式:
```
- 错误类型:
  * X 错误写法
  * V 正确写法
```

必须覆盖:
1. 注释语法错误
2. 路径/引用错误（如 D2 的容器节点引用）
3. 保留字冲突
4. 语法符号错误

---

## 示例编写规范

### 数量要求
- 至少 2 个示例
- 覆盖基础用法和高级用法

### 代码块格式

示例标题后跟代码块，使用对应引擎的语言标识。

### 质量要求
1. 可运行: 直接复制到 Kroki 能渲染
2. 注释正确: 使用该引擎的正确注释语法
3. 路径完整: 容器内节点使用完整路径（如 D2）
4. 无保留字冲突

### 示例覆盖场景
- 基础形状/节点
- 连接/箭头
- 样式应用
- 容器/分组（如支持）
- 跨容器引用（如支持）

---

## 质量检查清单

发布前检查:

- [ ] 注释语法是否正确（不同引擎不同）
- [ ] 所有示例是否可在 Kroki 渲染
- [ ] 路径引用是否使用完整路径（D2 等）
- [ ] 常见错误是否包含注释语法错误
- [ ] Kroki 限制是否准确
- [ ] 无 // 假设为通用注释

---

## 新增引擎流程

1. 创建目录 src/lib/syntax-md/{engine}/
2. 添加 _meta.yaml
3. 添加图表类型文档 {type}.md
4. 在 page.tsx 添加默认模板
5. 按检查清单验证

---

## 常见问题

Q: 示例应该多复杂?
A: 能展示语法要点即可，不追求复杂。单个示例 10-30 行。

Q: 如何验证示例可运行?
A: 复制到项目的编辑器中测试，或直接调用 Kroki API。

Q: 发现引擎文档有误怎么办?
A: 修正后在 git commit 中说明修正原因。
